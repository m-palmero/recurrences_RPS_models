# Investigating Mobility in Spatial Biodiversity Models through Recurrence Quantification Analysis

This repository contains the code for the analysis part of the research project titled "Investigating Mobility in Spatial Biodiversity Models through Recurrence Quantification Analysis". The primary goal is to apply Recurrence Quantification Analysis (RQA) to time series data generated by a spatial Rock-Paper-Scissor (RPS) model to understand how species mobility affects system dynamics.

This directory focuses specifically on the **RQA analysis** of pre-existing data. The code for **data generation** (the RPS simulation) will be located in a separate directory.

## Table of Contents

- [Authors](#authors)
- [Repository Structure](#repository-structure)
- [Code Description](#code-description)
- [Key Parameters](#key-parameters)
- [Prerequisites](#prerequisites)
- [Compilation & Execution](#compilation--execution)
- [Usage](#usage)
- [Output Description](#output-description)
- [Acknowledgements](#acknowledgements)

---

## Repository Structure

The project is organized into the following directories:

```
.
├── data/
│   └── mobility/
│       ├── 0.00-1.dat
│       ├── 0.00-2.dat
│       └── ...
├── figs/
│   └── (Generated plots are saved here)
├── results/
│   └── (Generated data files are saved here)
├── src/
│   ├── lib/
│   │   ├── common.h
│   │   ├── recurrence_functions.h
│   │   ├── auxiliary_functions.h
│   │   └── gnuplot_functions.h
│   ├── RQA_in_RPS_systems.c
│   └── RQA_in_RPS_systems.h
└── Makefile
```

-   **`data/mobility/`**: **Input Directory.** This folder must contain the time series data generated by the RPS simulation. Each file should be named according to the convention `<mobility>-<initial_condition_id>.dat`. For example, `0.30-5.dat` corresponds to the 5th simulation run with a mobility parameter of 0.3.
-   **`src/`**: Contains all C source code.
    -   **`lib/`**: Contains helper libraries for RQA calculations, plotting, and other auxiliary functions.
    -   **`RQA_in_RPS_systems.c`**: The main executable file containing the analysis logic.
-   **`results/`**: **Output Directory.** All numerical results from the analyses are saved here, typically organized in sub-folders based on the analysis parameters.
-   **`figs/`**: **Output Directory.** All plots generated by the program are saved here.
-   **`Makefile`**: The build script to compile and run the analysis.

---

## Code Description

The main program, `src/RQA_in_RPS_systems.c`, is designed to perform several types of analysis on the time series data. The desired analysis can be selected by uncommenting the corresponding function call in the `main()` function.

### Analysis Modes

1.  **`single_recurrence_analysis()`**
    -   Performs a full RQA on a *single* time series file.
    -   Useful for debugging, detailed inspection of a specific run, and generating individual recurrence plots.
    -   Outputs the recurrence plot as an image and can print all RQA measures to the console.

2.  **`ensemble_recurrence_analysis()`**
    -   Performs RQA on a large ensemble of time series for a *single, fixed mobility* value.
    -   For each of the 11 RQA measures, it creates a data file containing the measure for every simulation run in the ensemble.
    -   Useful for studying the statistical distribution of RQA measures at a specific mobility.

3.  **`ensemble_analysis_varying_mobility()`**
    -   **This is the primary analysis function for the research.**
    -   It iterates over a range of mobility values. For each mobility value, it computes RQA measures for an entire ensemble of simulations.
    -   It then calculates the **mean** and **standard error** of each RQA measure across the ensemble.
    -   The final output is a set of files, one for each RQA measure, showing how the measure changes as a function of mobility.

4.  **`ensemble_time_series_analysis()`**
    -   Performs a basic statistical analysis on an ensemble of time series for a fixed mobility.
    -   Calculates and saves the variance, volatility, and dominant frequency for each time series.

---

## Key Parameters

The main analysis parameters are defined as global variables at the top of `src/RQA_in_RPS_systems.c`. These can be modified before compilation to control the analysis.

-   `N`: The length of the time series to be analyzed.
-   `emb_dim`: The embedding dimension for phase space reconstruction.
-   `tau`: The time delay for phase space reconstruction.
-   `species`: The data column to analyze from the input files (e.g., `1` for the first species, `2` for the second, etc.).
-   `define_threshold_via_percentage`: Boolean (`true`/`false`). If `true`, the recurrence threshold `eps` is dynamically adjusted to achieve a fixed recurrence rate (`percentage`). If `false`, a fixed `eps` value is used.
-   `percentage`: The target recurrence rate (RR) if `define_threshold_via_percentage` is `true`.
-   `eps`: The fixed recurrence threshold if `define_threshold_via_percentage` is `false`.
-   `mobility`: The mobility value to be analyzed (used in single-run and fixed-mobility ensemble analyses).

---

## Prerequisites

To compile and run this code, you will need:

1.  A C compiler (e.g., `gcc`) and `make`.
2.  The **GNU Scientific Library (GSL)** for statistical calculations (like standard deviation and FFT).
3.  **Gnuplot** for generating plots from the C code.

On a Debian/Ubuntu system, these can be installed with:
```bash
sudo apt-get update
sudo apt-get install build-essential gsl-dev gnuplot
```

---

## Compilation & Execution

A `Makefile` is provided to streamline the compilation and execution process. All commands should be run from the root directory of the project.

-   **To compile and run the analysis:**
    ```bash
    make
    ```
    Because `run` is the default target in the `Makefile`, this single command will first compile the program (if any source files have changed) and then immediately execute it. The program will print its progress and the total run time upon completion.

-   **To only compile the program (without running):**
    If you only want to build the executable without running it, you can explicitly specify the program name as the target:
    ```bash
    make RQA_in_RPS_systems
    ```

-   **To clean up build files:**
    ```bash
    make clean
    ```
    This will remove the executable and all intermediate object files.

---

## Usage

1.  **Populate Data**: Ensure your time series data files are located in the `data/mobility/` directory with the correct naming scheme (`<mobility>-<run_id>.dat`).

2.  **Select Analysis**: Open `src/RQA_in_RPS_systems.c` and edit the `main()` function to uncomment the single analysis function you wish to run.

3.  **Configure Parameters**: Adjust the global parameters at the top of the file as needed for your analysis.

4.  **Execute**: Run the analysis from the project's root directory using the command:
    ```bash
    make
    ```

---

## Output Description

The program generates several output files in the `results/` and `figs/` directories.

-   **For `ensemble_analysis_varying_mobility`**:
    -   The results are saved in a sub-folder named after the `eps` or `RR` percentage (e.g., `results/RR=10.00/`).
    -   Inside this folder, files like `DET.dat`, `LAM.dat`, `ENTR_L.dat`, etc., are created.
    -   Each file contains three columns: `mobility`, `mean_of_RQA_measure`, and `standard_error_of_RQA_measure`. This format is ready for plotting.

-   **For `single_recurrence_analysis`**:
    -   `figs/time_series.png`: A plot of the input time series.
    -   `figs/recurrence_plot.png`: The generated recurrence plot.
    -   `rp.dat`: A two-column file with the (i, j) coordinates of the recurrent points, suitable for plotting with gnuplot.
    -   `rm.dat`: The full recurrence matrix (0s and 1s).

---


## Authors

-   Matheus Palmero;
-   Matheus Bongestab;

The development of this repository and parts of the source code were assisted by AI tools, including Google's Gemini and OpenAI's ChatGPT.
